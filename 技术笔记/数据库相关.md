# 数据库相关

## 索引

### Hash：

需要将所有数据添加到内存，比较耗费内存空间；如果所有的查询都是等值查询，会比较快，但是实际工作中是范围查询，所以不合适

### 二叉树 红黑树 

因为树的深度过深而导致IO次数过多，影响数据读取效率

### B树 

一棵m阶的B-Tree有如下特性：

1. 所有键值分布在整棵树中
2. 搜索可能在非叶子结点结束，在关键字全集中做一次查找，性能逼近二分查找
3. 每个节点最多拥有m个子树
4. 根节点至少有两个子树
5. 分支节点至少拥有m/2颗子树（除以节点和叶子节点外都是分支节点）
6. 所有叶子节点都在同一层、每个节点最多可以有m-1个key，并以升序排列

问题：每个节点都有key，同时也包含data，而每个页的存储空间是有限的，如果data比较大，会导致每个节点key的数量减少；当存储的数据量很大时会导致深度较大，增大查询时的IO次数，进而影响查询性能

### B+树

B+Tree相对于B-Tree有几点不同：

1. 非叶子节点只存储键值信息，降低了树的高度，加大索引的命中；
2. 所有叶子节点之间都有一个链指针；
3. 数据记录都存放在叶子节点中

### InnoDB

InnoDB存储引擎中页的大小为16KB

1. 通过B+树结构对主键创建索引，然后通过叶子节点储存记录，如果没有主键，那么会选择唯一键，如果没有唯一键，那么会生成一个6位的row——id作为主键。
2. 如果创建索引的键值是其他字段，那么在叶子节点中存储的是该记录的主键，然后在通过主键索引找到对应的记录。（相当于先通过其他字段的索引找到主键索引，再通过主键找到对应的数据）

InnoDB的数据文件本身就是主键索引文件，这样的索引被称为"“聚簇索引”，一个表只能有一个聚簇索引。

### MyISAM

MyISAM引擎的索引文件和数据文件是分离的。MyISAM引擎索引结构的叶子节点的数据域，存放的并不是实际的数据记录，而是数据记录的地址。索引文件与数据文件分离，这样的索引称为"非聚簇索引"。MyISAM的主索引与辅助索引区别并不大，只是主键索引不能有重复的关键字。

### 索引的分类

#### 主键索引

主键是一种唯一性的索引，但它必须指定为Primary Key，每个表只能有一个主键。

#### 唯一索引

索引列的所有值只能出现一次，即必须唯一，值可以为空。

#### 普通索引

基本的索引类型，值可以为空，没有唯一性的限制。

#### 全文索引

全文索引的索引类型为FULLTEXT。全文索引可以在varchar、char、text类型的列上创建

#### 组合索引

多列值组成一个索引，专门用于组合搜索

## 索引的优点

1. 大大减少了服务器需要扫描的数据量
2. 帮助服务器避免排序和临时表
3. 将随机IO变成顺序IO

## 索引的用处

1. 快速匹配Where子句的行
2. 从consideration中消除行，如果可以在多个索引之间进行选择，mysql通常会选择最少行的索引
3. 如果表有多列索引，则优化器可以使用索引的任何最左前缀来查找行
4. 当有表连接的时候，从其他表检索行数据
5. 查找特定索引列的max或者min值
6. 如果排序或分组时可用

## 三大范式

第一范式（1NF）：数据库表中的字段都是单一属性的，不可再分。这个单一属性由基本类型构成，包括整型、实数、字符型、逻辑型、日期型等。
第二范式（2NF）：数据库表中不存在非关键字段对任一候选关键字段的部分函数依赖（部分函数依赖指的是存在组合关键字中的某些字段决定非关键字段的情况），也即所有非关键字段都完全依赖于任意一组候选关键字。
第三范式（3NF）：在第二范式的基础上，数据表中如果不存在非关键字段对任一候选关键字段的传递函数依赖则符合第三范式。所谓传递函数依赖，指的是如 果存在"A → B → C"的决定关系，则C传递函数依赖于A。因此，满足第三范式的数据库表应该不存在如下依赖关系： 关键字段 → 非关键字段 x → 非关键字段y

作者：贾不假
链接：https://juejin.im/post/6850037271233331208
来源：掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

